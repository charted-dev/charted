# üêª‚Äç‚ùÑÔ∏èüì¶ charted-server: Free, open source, and reliable Helm Chart registry made in Kotlin.
# Copyright 2022-2023 Noelware <team@noelware.org>
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# This file was generated using a Kotlin DSL.
# If you want to modify the workflow, please change the Kotlin source and regenerate this YAML file.
# Generated with https://github.com/krzema12/github-workflows-kt

name: Linting and Unit Testing
on:
    workflow_dispatch: {}
    pull_request:
        types:
            - opened
            - synchronize
        branches:
            - issue/gh-**
            - feat/**
            - main
        paths-ignore:
            - .github/**
            - .vscode/**
            - assets/**
            - .gitignore
            - '**.md'
            - LICENSE
            - renovate.json
    push:
        branches:
            - issue/gh-**
            - feat/**
            - main
        paths-ignore:
            - .github/**
            - .vscode/**
            - assets/**
            - .gitignore
            - '**.md'
            - LICENSE
            - renovate.json
jobs:
    spotless:
        name: Spotless [${{matrix.runner}}, Java ${{matrix.java-version}}]
        runs-on: ${{matrix.runner}}
        strategy:
            matrix:
                java-version:
                    - 17
                    - 19
                runner:
                    - windows-latest
                    - ubuntu-latest
                    - macos-latest
                    - self-hosted
        steps:
            - id: step-0
              name: Checkout repository
              uses: actions/checkout@v3
              with:
                  submodules: true
            - id: step-1
              name: Setup Java ${{matrix.java-version}}
              uses: actions/setup-java@v3
              with:
                  java-version: ${{matrix.java-version}}
                  distribution: temurin
                  architecture: ${{matrix.runner == 'self-hosted' && 'aarch64' || 'amd64'}}
            - id: step-2
              name: Setup Node.js v19.x
              uses: actions/setup-node@v3
              with:
                  node-version: 19.x
                  architecture: ${{matrix.runner == 'self-hosted' && 'aarch64' || 'amd64'}}
            - id: step-3
              name: Setup Gradle
              uses: gradle/gradle-build-action@v2
            - id: step-4
              name: Validate Gradle Wrapper
              uses: gradle/wrapper-validation-action@v1
            - id: step-5
              name: Lint code-base with Spotless
              uses: gradle/gradle-build-action@v2
              with:
                  arguments: spotlessCheck --scan
            - id: step-6
              name: Compiles Kotlin source sets
              uses: gradle/gradle-build-action@v2
              with:
                  arguments: compileKotlin --scan
            - id: step-7
              name: Compiles Java source sets
              uses: gradle/gradle-build-action@v2
              with:
                  arguments: compileJava --scan
            - id: step-8
              name: Run unit and integration tests
              uses: gradle/gradle-build-action@v2
              with:
                  arguments: test --scan
